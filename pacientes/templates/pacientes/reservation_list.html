{% extends 'pacientes/base.html' %}
{% load static %}

{% block content %}

    <main>
        <div>
            <div>
                <h1>Reservas</h1>
                <ul>
                    <li>
                        <a href="{% url 'patient_list' %}">Dashboard</a>
                    </li>
                    <li>
                        <a class="active" href="#">/Reservas</a>
                    </li>
                </ul>
            </div>
        </div>

        <!-- Formulario de filtros -->
        <div>
            <div>
                <form method="get">
                    <div>
                        <div>
                            <label for="{{ filter_form.start_date.id_for_label }}">
                                {{ filter_form.start_date.label }}
                            </label>
                            {{ filter_form.start_date }}
                        </div>
                        <div>
                            <label for="{{ filter_form.end_date.id_for_label }}">
                                {{ filter_form.end_date.label }}
                            </label>
                            {{ filter_form.end_date }}
                        </div>
                        <div>
                            <button type="submit" class="btn-primary">
                                <i class='bx bx-filter'></i> Filtrar
                            </button>
                            <a href="{% url 'reservation_list' %}" class="btn-secondary">
                                <i class='bx bx-reset'></i> Limpiar
                            </a>
                        </div>
                    </div>
                </form>
            </div>
        </div>

        {% if reservations_by_date %}
            {% for date, sessions in reservations_by_date.items %}
            <div>
                <div>
                    <div>
                        <h3>{{ date|date:"l d F, Y" }}</h3>
                    </div>
                    <table>
                        <thead>
                            <tr>
                                <th>Hora</th>
                                <th>Paciente</th>
                                <th>Especialista</th>
                                <th>Sala</th>
                                <th>Nueva Actividad</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for session in sessions %}
                            <tr>
                                <td>{{ session.reserved_time|time:"H:i" }}</td>
                                <td>
                                    <p>{{ session.patient.name }} {{ session.patient.surname }}</p>
                                </td>
                                <td>{{ session.specialist.name }}</td>
                                <td>{{ session.room.name }}</td>
                                <td><span class="status completed">{{ session.new_activity|truncatechars:50 }}</span></td>
                                <td>
                                    <div class="action-buttons">
                                        <a href="{% url 'session_detail' session.id %}" class="btn-view">
                                            <i class='bx bx-show'></i>
                                        </a>
                                        <a href="{% url 'edit_session' session.id %}" class="btn-edit">
                                            <i class='bx bx-edit'></i>
                                        </a>
                                    </div>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
            {% endfor %}
        {% else %}
            <div>
                <div>
                    <i class='bx bx-info-circle'></i>
                    <span>No hay sesiones reservadas para el per√≠odo seleccionado.</span>
                </div>
            </div>
        {% endif %}
    </main>

    
{% endblock %}
