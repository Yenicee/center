{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link href='https://unpkg.com/boxicons@2.0.9/css/boxicons.min.css' rel='stylesheet'>
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
	<link rel="stylesheet" href="{% static 'pacientes/css/styles.css' %}">
	<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
	<title>CenTer</title>
</head>
<body>
	<!-- SIDEBAR  -->
		<section id="sidebar">
			<a href="#" class="brand"><img src="{% static 'pacientes/images/min_logo.png' %}" alt="" style="width: 50px;"></a>
			<ul class="side-menu">
				<li><a href="{% url 'patient_list' %}" class="active">
					<svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"
						width="20" height="20" fill="none" stroke="currentColor"
						stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
						<rect width="7" height="9" x="3" y="3" rx="1"></rect>
						<rect width="7" height="5" x="14" y="3" rx="1"></rect>
						<rect width="7" height="9" x="14" y="12" rx="1"></rect>
						<rect width="7" height="5" x="3" y="16" rx="1"></rect>
					</svg> Dashboard</a></li>
				<li class="divider" data-text="Consultorio"></li>
				<li>
					<a href="{% url 'calendar' %}"
					class="nav-link {% if request.resolver_match.url_name == 'calendar' %}active{% endif %}">
					<!-- SVG inline: hereda el color con currentColor -->
					<svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"
						width="20" height="20" fill="none" stroke="currentColor"
						stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
						<path d="M8 2v4"></path>
						<path d="M16 2v4"></path>
						<rect width="18" height="18" x="3" y="4" rx="2"></rect>
						<path d="M3 10h18"></path>
					</svg>
					<span>Agenda</span>
					</a>
				</li>

				<li>
					<a href="{% url 'reservation_list' %}">
						<svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"
						width="20" height="20" fill="none" stroke="currentColor"
						stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
						<path d="M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z"></path>
						<path d="M14 2v4a2 2 0 0 0 2 2h4"></path>
						<path d="M10 9H8"></path>
						<path d="M16 13H8"></path>
						<path d="M16 17H8"></path>
					</svg> Sesiones 
						{% with reserved_count=request.user.get_reserved_sessions_count %}
						{% if reserved_count > 0 %}
						<span class="badge bg-primary">{{ reserved_count }}</span>
						{% endif %}
						{% endwith %}
						<i class='bx bx-chevron-right icon-right'></i>
					</a>
					<ul class="side-dropdown">
						<li><a href="{% url 'reservation_list' %}"><i class="fas fa-list-ul icon-sub"></i>Ver sesiones</a></li>
						<li><a href="{% url 'new_session' %}"><i class="fas fa-plus icon-sub"></i>Nueva sesion</a></li>
					</ul>
				</li>

				<li>
					<a href="#">
					<svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"
						width="20" height="20" fill="none" stroke="currentColor"
						stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
						<path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"></path>
						<circle cx="9" cy="7" r="4"></circle>
						<path d="M22 21v-2a4 4 0 0 0-3-3.87"></path>
						<path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
					</svg>	 Pacientes <i class='bx bx-chevron-right icon-right' ></i></a>
					<ul class="side-dropdown">
						<li><a href="{% url 'patient_list' %}"><i class="fas fa-list-ul icon-sub"></i>Pacientes</a></li>
						<li><a href="{% url 'new_patient' %}"><i class="fas fa-plus icon-sub"></i>Nuevo paciente</a></li>
					</ul>
				</li>
				
				<li>
					<a href="#">
						<svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"
							width="20" height="20" fill="none" stroke="currentColor"
							stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
							<path d="M11 2v2"></path>
							<path d="M5 2v2"></path>
							<path d="M5 3H4a2 2 0 0 0-2 2v4a6 6 0 0 0 12 0V5a2 2 0 0 0-2-2h-1"></path>
							<path d="M8 15a6 6 0 0 0 12 0v-3"></path>
							<circle cx="20" cy="10" r="2"></circle>
						</svg> Especialistas 
						<i class='bx bx-chevron-right icon-right'></i>
					</a>
					<ul class="side-dropdown">
						<li><a href="{% url 'specialist_list' %}"><i class="fas fa-list-ul icon-sub"></i>Especialistas</a></li>
						<li><a href="{% url 'new_specialist' %}"><i class="fas fa-plus icon-sub"></i>Nuevo especialista</a></li>
					</ul>
				</li>

				<li>
			<a href="#">
				<svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"
					width="20" height="20" fill="none" stroke="currentColor"
					stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
					<path d="M6 22V4a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v18Z"></path>
					<path d="M6 12H4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h2"></path>
					<path d="M18 9h2a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2h-2"></path>
					<path d="M10 6h4"></path>
					<path d="M10 10h4"></path>
					<path d="M10 14h4"></path>
					<path d="M10 18h4"></path>
				</svg> Salas 
			<i class='bx bx-chevron-right icon-right'></i>
			</a>
			<ul class="side-dropdown">
			<li><a href="{% url 'room_list' %}"><i class="fas fa-list-ul icon-sub"></i>Salas</a></li>
			<li><a href="{% url 'new_room' %}"><i class="fas fa-plus icon-sub"></i>Nueva sala</a></li>
			</ul>
	       </li>
				
			<li class="divider" data-text="Administración"></li>

			<li>
			<a href="#">
				<!-- Icono cartera/finanzas -->
				<svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"
					width="20" height="20" fill="none" stroke="currentColor"
					stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
				<rect width="20" height="14" x="2" y="5" rx="2"></rect>
				<line x1="2" x2="22" y1="10" y2="10"></line>
				</svg> Finanzas
				<i class='bx bx-chevron-right icon-right'></i>
			</a>

			<ul class="side-dropdown">
				<li>
				<a href="{% url 'finance_dashboard' %}"
					class="{% if request.resolver_match.url_name == 'finance_dashboard' %}active{% endif %}">
					<i class="fas fa-chart-line icon-sub"></i> Dashboard
				</a>
				</li>
				<li>
				<a href="{% url 'expense_list' %}"
					class="{% if request.resolver_match.url_name in 'expense_list expense_create expense_edit expense_delete' %}active{% endif %}">
					<i class="fas fa-file-invoice-dollar icon-sub"></i> Gastos
				</a>
				</li>
				<li>
				<a href="{% url 'payment_list' %}"
					class="{% if request.resolver_match.url_name in 'payment_list create_payment edit_payment payment_detail delete_payment' %}active{% endif %}">
					<i class="fas fa-credit-card icon-sub"></i> Cobros
				</a>
				</li>
			</ul>
			</li>

		</ul>
			<div class="ads">
				<div class="wrapper">
					<a href="mailto:noreply.tucentro@gmail.com" class="btn-upgrade">Consultas</a>
					<p>Comunicate con <span>soporte</span> noreply.tucentro@gmail.com</p>
				</div>
			</div>
		</section>
	<!-- SIDEBAR -->
	<!-- NAVBAR -->
	<section id="content">
		<!-- NAVBAR -->
		<nav>
	<i class='bx bx-menu toggle-sidebar' ></i>
	
	<form action="#">
		<div class="form-group">
			<input type="text" placeholder="Buscar...">
			<i class='bx bx-search icon' ></i>
		</div>
	</form>

	<!-- CAMPANA DE NOTIFICACIONES -->
   <div class="notification-bell">
     <i class='bx bx-bell' id="bell-icon"></i>
     <span class="notification-badge" id="notification-count" style="display: none;">0</span>
    
      <!-- Dropdown de notificaciones -->
      <div id="notification-dropdown">
        <div class="notification-header">
            <h4>Notificaciones</h4>
            <button class="mark-all-read" id="mark-all-read" title="Marcar todas como leídas">
                <i class='bx bx-check-double'></i>
            </button>
        </div>
        
         <div class="notification-list" id="notification-list">
            <div class="notification-loading">
                <i class='bx bx-loader-alt bx-spin'></i> Cargando...
            </div>
         </div>
        
         <div class="notification-footer">
            <a href="#" id="view-all-notifications">Ver todas</a>
         </div>
       </div>
   </div>

	<div class="profile">
		<span class="username">
			{% if user.first_name %}
			{{ user.first_name }} {{ user.last_name }}
			{% else %}
			{{ user.username }}
			{% endif %}
		</span>
		<img src="{% static 'pacientes/images/usuario.png' %}" alt="">
		<ul class="profile-link">
			{% if user.is_authenticated %}
			<li>
				<form id="logout-form" method="post" action="{% url 'logout' %}" style="display: none;">
				{% csrf_token %}
				</form>
				<a href="#" onclick="event.preventDefault(); document.getElementById('logout-form').submit();">
				<i class='bx bxs-log-out-circle'></i>Cerrar sesión
				</a>
			</li>
			{% endif %}
		</ul>
	</div>
 </nav>
		<!-- NAVBAR -->
		<!-- MAIN -->
		<main>
			<!-- Contenedor dividido en dos columnas -->
			<div class="content-container">
				<!-- Columna izquierda -->
				<div class="left-column {% block left_column_class %}{% endblock %}">
					{% block left_content %}
					<!-- Contenido específico aquí -->
					{% endblock %}
				</div>
			
				<!-- Columna derecha -->
				<div class="right-column {% block right_column_class %}{% endblock %}">
					{% block right_content %}
					<!-- Calendario u otros widgets aquí -->
					{% endblock %}
				</div>
			</div>

			  <!--el bloque content muestra los hijos -->
			  <div class="main-content">
                {% block content %}
                <!-- Contenido principal de las vistas hijas aquí -->
                {% endblock %}
            </div>
			{% block extra_js %}{% endblock %}
						{% if messages %}
				{% for message in messages %}
					<div class="alert {{ message.tags }}">{{ message }}</div>
				{% endfor %}
			{% endif %}
		</main>
		<!-- MAIN -->

	<script src="{% static '/pacientes/js/script.js' %}"></script>

	<script>
		document.addEventListener("DOMContentLoaded", function() {
			const buttons = document.querySelectorAll(".tab-button");
			const contents = document.querySelectorAll(".tab-content");
		
			buttons.forEach(button => {
				button.addEventListener("click", function() {
					
					buttons.forEach(btn => btn.classList.remove("active"));
					contents.forEach(content => content.classList.remove("active"));
		
					button.classList.add("active");
					const targetContent = document.getElementById(button.getAttribute("data-tab"));
					targetContent.classList.add("active");
				});
			});
		});
	</script>
	
	<script>
		document.addEventListener('DOMContentLoaded', function () {
			// Interceptar enlaces o botones con clase "admin-only"
			document.querySelectorAll('.admin-only').forEach(function (element) {
				element.addEventListener('click', function (e) {
					e.preventDefault();
					const url = this.getAttribute('href');
	
					fetch(url, { headers: { 'x-requested-with': 'XMLHttpRequest' } })
						.then(response => {
							if (response.status === 403) {
								Swal.fire({
									icon: 'error',
									title: 'Acceso Denegado',
									text: 'Esta acción es exclusiva para administradores.',
								});
							} else {
								window.location.href = url;
							}
						})
						.catch(error => {
							console.error('Error:', error);
						});
				});
			});
		});
	</script>
	
	<!-- SCRIPT DE NOTIFICACIONES(NUEVO) -->
    <script src="{% static 'pacientes/js/notifications.js' %}"></script>
</body>
</html>